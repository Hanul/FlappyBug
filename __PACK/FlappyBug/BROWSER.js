FlappyBug.Game=CLASS(e=>{const n=360;e.getGameWidth=(()=>{return n});return{preset:()=>{return VIEW},init:e=>{TITLE("FlappyBug :: Game");let n,t,o,i,p=SOUND({mp3:FlappyBug.R("bgm.mp3"),ogg:FlappyBug.R("bgm.ogg"),isLoop:!0}).play(),a=SOUND({mp3:FlappyBug.R("pass.mp3"),ogg:FlappyBug.R("pass.ogg")}),r=FlappyBug.STORE("score"),g=0,u=SkyEngine.Node({c:[SkyEngine.Background({speedX:190,src:FlappyBug.R("sky.jpg"),isNotToRepeatY:!0}),t=SkyEngine.Node({y:-500,speedX:200,collider:SkyEngine.Rect({width:256,height:256})}),i=SkyEngine.Node(),FlappyBug.GameObject.Ground(),o=FlappyBug.GameObject.Bug()],dom:n=DIV({style:{width:200,backgroundColor:"#73BE31",border:"5px solid #666",padding:10},c:[P({c:"BEST SCORE: "+(void 0===r.get("best")?0:r.get("best"))}),P({style:{fontSize:12},c:"TOUCH or SPACE KEY to START"})]})}).appendTo(SkyEngine.Screen);ANIMATE({node:n,keyframes:{from:{transform:"scaleY(0)"},to:{transform:"scaleY(1)"}},duration:.2,timingFunction:"ease-out"});let c,l=DIV({style:{position:"fixed",left:0,top:0,textAlign:"center",width:"100%",fontSize:20,marginTop:10},c:0}).appendTo(BODY);o.onMeet(t,()=>{o.setY(o.getY()+10),o.setSpeedY(0)}),o.on("die",()=>{(void 0===r.get("best")||parseInt(r.get("best"),10)<g)&&r.save({name:"best",value:g}),p.stop(),i.empty(),n=DIV({style:{width:200,margin:"auto",backgroundColor:"#73BE31",border:"5px solid #666",padding:10},c:[P({c:"SCORE: "+g}),P({c:"BEST SCORE: "+r.get("best")}),P({style:{marginTop:10,fontSize:12},c:"TOUCH or SPACE KEY to RESTART"})]}),u.addDom(n),ANIMATE({node:n,keyframes:{from:{transform:"scaleY(0)"},to:{transform:"scaleY(1)"}},duration:.2,timingFunction:"ease-out"}),void 0!==s&&(s.remove(),s=void 0),c=!1});let s,d=()=>{g=0,l.empty(),l.append(g),void 0!==c&&p.play(),o.revive(),ANIMATE({node:n,keyframes:{from:{transform:"scaleY(1)"},to:{transform:"scaleY(0)"}},duration:.2,timingFunction:"ease-in"},()=>{n.remove()}),s=INTERVAL(2,RAR(()=>{let e=FlappyBug.GameObject.Pipe({x:o.getX()+1e3,y:RANDOM({min:-100,max:100}),on:{offscreen:n=>{e.getX()<o.getX()&&e.remove()}}}).appendTo(i),n=SkyEngine.Rect({x:o.getX()+1e3+40,width:40,height:800,collider:SkyEngine.Rect({width:40,height:800}),on:{offscreen:e=>{n.getX()<o.getX()&&n.remove()}}}).appendTo(i);n.onMeet(o,()=>{g+=1,l.empty(),l.append(g),a.play()})})),c=!0},y=EVENT("keydown",e=>{" "===e.getKey()&&(c!==!0&&d(),o.jump(),e.stop())}),m=EVENT("touchstart",e=>{c!==!0&&d(),o.jump(),e.stop()});e.on("close",()=>{p.stop(),p=void 0,u.remove(),l.remove(),y.remove(),m.remove(),void 0!==s&&(s.remove(),s=void 0)})}}}),FlappyBug.Home=CLASS({preset:()=>{return VIEW},init:e=>{TITLE("FlappyBug :: Home");let n,t=SkyEngine.Node({dom:n=DIV({style:{backgroundColor:"#73BE31",padding:20,textAlign:"center"},c:[H1({c:[IMG({src:FlappyBug.R("logo.png")}),BR(),"Made with ",A({href:"https://github.com/Hanul/SkyEngine",target:"_blank",style:{textDecoration:"underline"},c:"SkyEngine"})]}),A({style:{display:"block",marginTop:10,padding:10,backgroundColor:"#fff",color:"#666",borderRadius:10,fontWeight:"bold"},c:"START GAME",on:{tap:()=>{FlappyBug.GO("Game")}}}),DIV({style:{marginTop:10,fontSize:12},c:[A({href:"https://github.com/Hanul/SkyEngine-Sample-FlappyBug",target:"_blank",style:{textDecoration:"underline"},c:"SOURCE CODE"})," Â· ",A({href:"http://uppercase.io",target:"_blank",style:{textDecoration:"underline"},c:"UPPERCASE"})]})]})}).appendTo(SkyEngine.Screen);ANIMATE({node:n,keyframes:{from:{transform:"scaleY(0)"},to:{transform:"scaleY(1)"}},duration:.2,timingFunction:"ease-out"}),e.on("close",()=>{ANIMATE({node:n,keyframes:{from:{transform:"scaleY(1)"},to:{transform:"scaleY(0)"}},duration:.2,timingFunction:"ease-in"},()=>{t.remove()})})}}),FlappyBug.MAIN=METHOD({run:()=>{FlappyBug.MATCH_VIEW({uri:"",target:FlappyBug.Home}),FlappyBug.MATCH_VIEW({uri:"Game",target:FlappyBug.Game})}}),FlappyBug("GameObject").Bug=CLASS({preset:()=>{return SkyEngine.Sprite},params:()=>{return{speedX:200,src:FlappyBug.R("bug.png"),spriteWidth:40,fps:10,collider:SkyEngine.Circle({x:2,width:30,height:20})}},init:(e,n)=>{let t,o=SOUND({mp3:FlappyBug.R("jump.mp3"),ogg:FlappyBug.R("jump.ogg")}),i=SOUND({mp3:FlappyBug.R("die.mp3"),ogg:FlappyBug.R("die.ogg")});SkyEngine.Screen.followX({target:n,x:-200}),n.onMeet(FlappyBug.GameObject.Ground,()=>{t=!0,i.play(),n.hide(),n.fireEvent("die")}),n.onMeet(FlappyBug.GameObject.Pipe,()=>{t=!0,i.play(),n.hide(),n.fireEvent("die")});n.revive=(()=>{n.setY(0),n.setSpeedY(0),n.setAccelY(0),n.setAngle(0),n.setRotationSpeed(0),t=!1,n.show()}),n.jump=(()=>{t!==!0&&(n.setSpeedY(-500),n.setAccelY(1e3),n.setAngle(315),n.rotateTo({toAngle:90,speed:100}),o.play())})}}),FlappyBug("GameObject").Ground=CLASS({preset:()=>{return SkyEngine.Background},params:()=>{return{y:368,src:FlappyBug.R("ground.png"),isNotToRepeatY:!0,collider:SkyEngine.Rect({speedX:200,width:256,height:256})}}}),FlappyBug("GameObject").Pipe=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n)=>{n.append(SkyEngine.Image({src:FlappyBug.R("upipe.png"),y:-250,collider:SkyEngine.Rect({width:40,height:400})})),n.append(SkyEngine.Image({src:FlappyBug.R("dpipe.png"),y:250,collider:SkyEngine.Rect({width:40,height:400})}))}});